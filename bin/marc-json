#!/usr/bin/env node
import program from '../lib/cli'
import { processRecords } from '../lib/recordstream'
import marcjson = require('../lib/marcjson'
import stringify from "json-stringify-pretty-compact"

program
  .usage('marc-json [options] files...')
  .description('Parse MARC or related format files and convert records to JSON')
  .option('-f, --format [name]  specify input format (json|ndjson)')
  .option('-t, --to [name]      specify output format (json|ndjson)')
  .action((sources, options) => {
    const records = []
    Object.assign(options, { sources, action: rec => records.push(marcjson(rec)) })
    processRecords(options).then( () => {
      if (options.to === 'ndjson') {
        for (let rec of records) {
          console.log(stringify(rec))
        }
      } else {
        console.log(stringify(records))
      }
    })
  })
  .parse(process.argv)
